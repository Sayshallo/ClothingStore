{% extends "base.html" %}

{% load static %}

{% block css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'cart/css/cart.css' %}">

<style>
        body {
            background-image: url('{% static "cart/img/cart.jpg" %}');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
        }
</style>
{% endblock %}

{% block title %}Корзина - Denny Rose{% endblock %}

{% block content %}

{% if messages %}
<div id="alert-container" style="position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1050;
    opacity: 0;
    transition: opacity 0.5s, transform 0.5s;">
    {% for message in messages %}
    <div class="alert d-flex align-items-center alert-{{ message.tags }}" role="alert">
        <div>{{ message.message }}</div>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="header" style="height: 10vh; background-color: #00000075; display: flex; align-items: center; justify-content: center;">
    <h1>Корзина</h1>
</div>

<div class="cart-container">
    {% if cart_items %}
    <table class="table table-hover">
        <thead>
            <tr>
                <th></th>
                <th>Название</th>
                <th>Цвет</th>
                <th>Размер</th>
                <th>Количество</th>
                <th>Стоимость</th>
            </tr>
        </thead>
        <tbody id="cart-items">
            {% for item in cart_items %}
                    <tr data-product-id="{{ item.id }}" data-price="{{ item.price }}">
                        <td>
                            <div class="form-check">
                                <input
                                    class="form-check-input cart-item-checkbox"
                                    type="checkbox"
                                    value="{{ item.id }}_{{ item.color }}_{{ item.size }}"
                                    checked
                                >
                            </div>
                        </td>
                        <td><h5>{{ item.product_name }}</h5></td>
                        <td>{{ item.color }}</td>
                        <td>{{ item.size }}</td>
                        <td>
                            <!-- Форма теперь находится внутри ячейки -->
                            <form action="{% url 'update_product' %}" method="post" class="product-form">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-secondary quantity-btn" data-action="decrease">-</button>
                                <span class="quantity">{{ item.quantity }}</span>
                                <button class="btn btn-sm btn-secondary quantity-btn" data-action="increase">+</button>
                                <button class="btn btn-sm btn-danger delete-btn">Удалить</button>

                                <!-- Скрытые поля -->
                                <input type="hidden" name="id" value="{{ item.id }}">
                                <input type="hidden" name="size" value="{{ item.size }}">
                                <input type="hidden" name="color" value="{{ item.color }}">
                                <input type="hidden" name="qnt" value="{{ item.quantity }}">
                                <input type="hidden" name="new_qnt" value="">
                            </form>
                        </td>
                        <td class="item-total-cost">{{ item.price | floatformat:2 }}</td>
                    </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <h2>Товаров нет</h2>
    {% endif %}
</div>

<hr style="margin: 0;">

<div class="footer" style="height: 16.5%; display: flex; align-items: center; justify-content: space-around; padding: 0 20px;">
    <form id="checkout-form" action="order" method="post">
        {% csrf_token %}
        <div id="hidden-inputs"></div>
        <input type="hidden" id="order_total_cost" name="total_cost" value="">
        <button type="submit" class="btn btn-primary">Оформить заказ</button>
    </form>
    <span id="total-order-cost" style="text-shadow: 0px 0px 10px  white;font-weight: bold;">Общая стоимость: 0 рублей</span>
</div>


<!-- Контейнер для уведомлений -->
<div id="notification-container"></div>
{% endblock %}

{% block js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'cart/js/cart.js' %}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const alertContainer = document.getElementById('alert-container');
        if (alertContainer) {
            alertContainer.style.opacity = '1';
            alertContainer.style.transform = 'translateY(20%)';

            // Скрываем уведомление через 2 секунды
            setTimeout(() => {
                alertContainer.style.opacity = '0';
                alertContainer.style.transform = 'translateY(-100%)';
            }, 2000);
        }
    });
    </script>
{% endblock %}