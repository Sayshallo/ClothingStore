{% extends "base.html" %}

{% load static %}

{% block css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
        <link rel="stylesheet" href="{% static 'catalog/css/catalog.css' %}">
    {% endblock %}

{% block title %}{{ category.name }} - Denny Rose{% endblock %}

{% block content %}
<style>
    body{
        background: url('{% static 'authorization/img/auth.jpg' %}') no-repeat center center/cover;
    }
</style>

<h1 style="text-align: center;">{{ category.name }}</h1>
<!-- Отображение подкатегорий -->
<div class="subcategory-container">
    {% if subcategories %}
        {% for subcategory in subcategories %}
            <form action="{% url 'products' subcategory.name %}" class="subcategory">
                <img src="{{ subcategory.image_url }}" alt="{{ subcategory.name }}">
                <div class="subcategory-name">{{ subcategory.name }}</div>
                <button type="submit" class="link-btn btn btn-warning">Перейти</button>
                <input type="hidden" name="subcategory_name" value="{{ subcategory.name }}" />
            </form>
        {% endfor %}
    {% else %}
        <div>Подкатегории отсутствуют</div>
    {% endif %}
</div>

<!-- Bootstrap Modal -->
<div class="modal fade" id="productsModal" tabindex="-1" aria-labelledby="productsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered" style="max-height: 80vh;">
    <div class="modal-content" style="height: 80vh; overflow-y: auto;">
      <div class="modal-header">
        <h5 class="modal-title" id="productsModalLabel">Товары</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
      </div>
      <div class="modal-body">
        {% for subcategory in subcategories %}
          <div class="product-list" id="products-{{ subcategory.id }}">
            {% comment %} Показываем товары только если product.subcategory.id совпадает с подкатегорией {% endcomment %}
            {% with items=products|dictsort:"id" %}
                {% for product in products %}
                    {% if product.subcategory.id == subcategory.id %}
                        <div class="product-card" data-product-id="{{ product.id }}">
                            <img src="{{ product.image_url }}" alt="{{ product.name }}">
                            <div>{{ product.name }}</div>
                            <div class="quantity-control initial">
                                <button type="button" class="btn btn-success btn-plus">+</button>
                                <div class="count">0</div>
                                <button type="button" class="btn btn-danger btn-minus" style="display:none;">-</button>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            {% endwith %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script src="{% static 'catalog/js/catalog.js' %}"></script>
{% endblock %}